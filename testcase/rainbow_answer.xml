<?xml version="1.0" encoding="UTF-8"?>
<testcases>
    <testcase name="rainbow自动接听">
        <!-- 建立P2P连接：B监听9999，连接到A的172.34.191.34:9998 -->
        <step type="network" action="init" content="172.24.191.21:9998" local_port="9999" />
        <step type="wait" content="3" />
        
        <!-- 等待A的就绪信号 -->
        <step type="network" action="receive" content="ready" timeout="30" />
        <!-- 发送就绪信号给A，确认连接双向建立 -->
        <step type="network" action="send" content="ready" data="{&quot;status&quot;: &quot;B_ready&quot;}" />
        <step type="wait" content="1" />
        
        <!-- 等待A的call_start信号，确认A已准备好发起呼叫 -->
        <step type="network" action="receive" content="call_start" timeout="30" />
        <step type="wait" content="1" />
        
        <!-- 连接确认完成，开始等待来电 -->
        <!-- 等待来电弹窗出现，可根据实际情况调整等待时间 -->
        <step type="wait" action="sleep" content="5" />
        <!-- OCR查找并点击“接听”按钮，按钮文字可根据实际界面调整，如“接听”、“Answer”等 -->
        <step type="icon" action="find_and_move" content="png/rainbow/accept.png" />
        <!--step type="ocr" action="find_and_click" content="Accept" /-->
        <step type="mouse" action="click" content="left" />
        <step type="wait" content="1" />
        
        <!-- 向A发送call_answer信号，确认已接听，通话建立 -->
        <step type="network" action="send" content="call_answer" data="{&quot;from&quot;: &quot;B&quot;}" />
        <step type="wait" content="1" />
        
        <!-- 通话建立完成，后续可以添加通话过程中的操作 -->
        <!-- 等待A的audio_play_start消息，确认A准备开始播放 -->
        <step type="network" action="receive" content="audio_play_start" timeout="30" />
        <step type="wait" content="0.5" />
        
        <!-- 使用设备24异步开始录音（设定足够长的时长） -->
        <step type="audio" action="record_async" content="testAudioFile/record_sine_40.wav" device_id="24" duration="60" />
        
        <!-- 等待A的audio_play_end消息，确认播放已结束 -->
        <step type="network" action="receive" content="audio_play_end" timeout="30" />
        <step type="wait" content="0.5" />
        
        <!-- 收到消息后停止录音 -->
        <step type="audio" action="stop_record" />
        <step type="wait" content="1" />
    </testcase>
</testcases>
